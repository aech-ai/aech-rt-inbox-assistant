{
  "name": "inbox-assistant",
  "type": "cli",
  "description": "Query Inbox Assistant state and preferences.",
  "command": "aech-cli-inbox-assistant",
  "actions": [
    {
      "name": "list",
      "description": "List ingested emails.",
      "parameters": [
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of emails to list",
          "default": 20
        },
        {
          "name": "include-read",
          "type": "flag",
          "required": false,
          "description": "Include read emails"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "history",
      "description": "View triage history.",
      "parameters": [
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of entries to list",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "search",
      "description": "Search emails and attachments using full-text search.",
      "parameters": [
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of results to return",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "dbpath",
      "description": "Get the absolute path to the user's database.",
      "parameters": []
    },
    {
      "name": "sync-status",
      "description": "Show the sync status for all folders.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "stats",
      "description": "Show corpus statistics.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "attachment-status",
      "description": "Show attachment extraction status.",
      "parameters": [
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of attachments to list",
          "default": 20
        },
        {
          "name": "status",
          "type": "option",
          "required": false,
          "description": "Filter by status (pending/completed/failed/skipped/extracting)"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "schema",
      "description": "Get the database schema (CREATE TABLE statements).",
      "parameters": []
    },
    {
      "name": "reply-needed",
      "description": "List threads currently marked as requiring a reply. Queries Working Memory (wm_threads table). By default excludes stale threads (no activity for 3+ days).",
      "parameters": [
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of threads to list",
          "default": 20
        },
        {
          "name": "include-stale",
          "type": "flag",
          "required": false,
          "description": "Include stale threads (no activity for 3+ days)"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-today",
      "description": "Show today's calendar events.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-week",
      "description": "Show this week's calendar events.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-upcoming",
      "description": "Show upcoming events in the next N hours.",
      "parameters": [
        {
          "name": "hours",
          "type": "option",
          "required": false,
          "description": "Number of hours to look ahead",
          "default": 24
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-free",
      "description": "Show free time slots on a given date.",
      "parameters": [
        {
          "name": "date",
          "type": "argument",
          "required": true,
          "description": "Date to check (YYYY-MM-DD)"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-busy",
      "description": "Check if busy during a time range.",
      "parameters": [
        {
          "name": "start",
          "type": "argument",
          "required": true,
          "description": "Start datetime (YYYY-MM-DDTHH:MM or YYYY-MM-DD HH:MM)"
        },
        {
          "name": "end",
          "type": "argument",
          "required": true,
          "description": "End datetime"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-event",
      "description": "Get details of a specific calendar event.",
      "parameters": [
        {
          "name": "event_id",
          "type": "argument",
          "required": true,
          "description": "Event ID"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-search",
      "description": "Search calendar events by subject or attendee.",
      "parameters": [
        {
          "name": "query",
          "type": "argument",
          "required": true,
          "description": "Search query (subject or attendee email)"
        },
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of results",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-meetings-with",
      "description": "List meetings with a specific person.",
      "parameters": [
        {
          "name": "email",
          "type": "argument",
          "required": true,
          "description": "Email address to search for"
        },
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of results",
          "default": 50
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "calendar-prep",
      "description": "Prepare briefing for a meeting - includes attendee email history.",
      "parameters": [
        {
          "name": "event_id",
          "type": "argument",
          "required": false,
          "description": "Event ID (or use --next for next meeting)"
        },
        {
          "name": "next",
          "type": "flag",
          "required": false,
          "description": "Prepare for next upcoming meeting"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output instead of JSON"
        }
      ]
    },
    {
      "name": "event-create",
      "description": "Schedule a new calendar event (queued for RT service execution).",
      "parameters": [
        {
          "name": "subject",
          "type": "argument",
          "required": true,
          "description": "Event subject"
        },
        {
          "name": "start",
          "type": "argument",
          "required": true,
          "description": "Start datetime (YYYY-MM-DDTHH:MM)"
        },
        {
          "name": "end",
          "type": "argument",
          "required": true,
          "description": "End datetime (YYYY-MM-DDTHH:MM)"
        },
        {
          "name": "attendees",
          "type": "option",
          "required": false,
          "description": "Comma-separated attendee emails"
        },
        {
          "name": "location",
          "type": "option",
          "required": false,
          "description": "Location"
        },
        {
          "name": "body",
          "type": "option",
          "required": false,
          "description": "Event description"
        },
        {
          "name": "online",
          "type": "flag",
          "required": false,
          "description": "Create as Teams meeting"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "event-update",
      "description": "Update/reschedule a calendar event (queued for RT service execution).",
      "parameters": [
        {
          "name": "event_id",
          "type": "argument",
          "required": true,
          "description": "Event ID to update"
        },
        {
          "name": "subject",
          "type": "option",
          "required": false,
          "description": "New subject"
        },
        {
          "name": "start",
          "type": "option",
          "required": false,
          "description": "New start datetime"
        },
        {
          "name": "end",
          "type": "option",
          "required": false,
          "description": "New end datetime"
        },
        {
          "name": "location",
          "type": "option",
          "required": false,
          "description": "New location"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "event-cancel",
      "description": "Cancel a calendar event (queued for RT service execution).",
      "parameters": [
        {
          "name": "event_id",
          "type": "argument",
          "required": true,
          "description": "Event ID to cancel"
        },
        {
          "name": "notify",
          "type": "flag",
          "required": false,
          "description": "Send cancellation to attendees",
          "default": true
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "event-respond",
      "description": "Respond to a meeting invite (queued for RT service execution).",
      "parameters": [
        {
          "name": "event_id",
          "type": "argument",
          "required": true,
          "description": "Event ID"
        },
        {
          "name": "response",
          "type": "argument",
          "required": true,
          "description": "Response: accept, tentative, or decline"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "actions-pending",
      "description": "List pending actions awaiting execution.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "actions-history",
      "description": "Show action execution history.",
      "parameters": [
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of actions to show",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "timezone",
      "description": "Show the current timezone being used for calendar queries.",
      "parameters": []
    },
    {
      "name": "prefs show",
      "description": "Show the current preferences.json.",
      "parameters": []
    },
    {
      "name": "prefs set",
      "description": "Set a preference key. Invalid keys will be REJECTED - use 'prefs keys' to see valid options. Valid keys: timezone, vip_senders, teams_default_target, digest_day, digest_time_local, meeting_prep, categories.",
      "parameters": [
        {
          "name": "key",
          "type": "argument",
          "required": true,
          "description": "Preference key (must be a valid known key)"
        },
        {
          "name": "value",
          "type": "argument",
          "required": true,
          "description": "Preference value (string/number/bool/JSON)"
        }
      ]
    },
    {
      "name": "prefs keys",
      "description": "List all valid preference keys that can be set.",
      "parameters": []
    },
    {
      "name": "prefs unset",
      "description": "Remove a preference key from preferences.json.",
      "parameters": [
        {
          "name": "key",
          "type": "argument",
          "required": true,
          "description": "Preference key"
        }
      ]
    },
    {
      "name": "wm snapshot",
      "description": "Get complete working memory snapshot for context injection. Shows active threads, pending decisions, open commitments, and today's calendar.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        },
        {
          "name": "llm",
          "type": "flag",
          "required": false,
          "description": "LLM-optimized output for context injection"
        }
      ]
    },
    {
      "name": "wm threads",
      "description": "Query active email threads from working memory.",
      "parameters": [
        {
          "name": "needs-reply",
          "type": "flag",
          "required": false,
          "description": "Only show threads needing reply"
        },
        {
          "name": "urgency",
          "type": "option",
          "required": false,
          "description": "Filter by urgency (immediate/today/this_week/someday)"
        },
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of threads to show",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "wm decisions",
      "description": "List pending decisions awaiting response.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "wm commitments",
      "description": "List open commitments made by the user.",
      "parameters": [
        {
          "name": "overdue",
          "type": "flag",
          "required": false,
          "description": "Only show overdue commitments"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "wm contacts",
      "description": "Query known contacts from working memory.",
      "parameters": [
        {
          "name": "external",
          "type": "flag",
          "required": false,
          "description": "Only external contacts"
        },
        {
          "name": "search",
          "type": "option",
          "required": false,
          "description": "Search by email or name"
        },
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of contacts to show",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "wm observations",
      "description": "View recent passive observations (patterns, preferences learned).",
      "parameters": [
        {
          "name": "days",
          "type": "option",
          "required": false,
          "description": "Days of observations to show",
          "default": 7
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "wm projects",
      "description": "View inferred projects from email activity.",
      "parameters": [
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "alerts list",
      "description": "List all user-defined alert rules.",
      "parameters": [
        {
          "name": "enabled-only",
          "type": "flag",
          "required": false,
          "description": "Only show enabled rules"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "alerts add",
      "description": "Add a new alert rule using natural language. Examples: 'alert me when CFO emails about budget', 'notify when I send email to legal@'.",
      "parameters": [
        {
          "name": "rule",
          "type": "argument",
          "required": true,
          "description": "Natural language alert rule"
        },
        {
          "name": "channel",
          "type": "option",
          "required": false,
          "description": "Notification channel: teams, email",
          "default": "teams"
        },
        {
          "name": "target",
          "type": "option",
          "required": false,
          "description": "Channel target (chat ID, email address)"
        },
        {
          "name": "cooldown",
          "type": "option",
          "required": false,
          "description": "Cooldown between triggers (minutes)",
          "default": 30
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "alerts remove",
      "description": "Remove an alert rule.",
      "parameters": [
        {
          "name": "rule_id",
          "type": "argument",
          "required": true,
          "description": "Rule ID to remove (can be partial)"
        }
      ]
    },
    {
      "name": "alerts enable",
      "description": "Enable an alert rule.",
      "parameters": [
        {
          "name": "rule_id",
          "type": "argument",
          "required": true,
          "description": "Rule ID to enable (can be partial)"
        }
      ]
    },
    {
      "name": "alerts disable",
      "description": "Disable an alert rule.",
      "parameters": [
        {
          "name": "rule_id",
          "type": "argument",
          "required": true,
          "description": "Rule ID to disable (can be partial)"
        }
      ]
    },
    {
      "name": "alerts history",
      "description": "View alert trigger history.",
      "parameters": [
        {
          "name": "rule-id",
          "type": "option",
          "required": false,
          "description": "Filter by rule ID"
        },
        {
          "name": "limit",
          "type": "option",
          "required": false,
          "description": "Number of entries",
          "default": 20
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    },
    {
      "name": "alerts show",
      "description": "Show details of a specific alert rule.",
      "parameters": [
        {
          "name": "rule_id",
          "type": "argument",
          "required": true,
          "description": "Rule ID to show (can be partial)"
        },
        {
          "name": "human",
          "type": "flag",
          "required": false,
          "description": "Human-readable output"
        }
      ]
    }
  ],
  "documentation": {
    "usage": "aech-cli-inbox-assistant <command> [options]",
    "examples": [
      "aech-cli-inbox-assistant list --human",
      "aech-cli-inbox-assistant search 'query' --limit 10",
      "aech-cli-inbox-assistant reply-needed --human",
      "aech-cli-inbox-assistant wm snapshot --llm",
      "aech-cli-inbox-assistant wm threads --needs-reply",
      "aech-cli-inbox-assistant alerts list --human",
      "aech-cli-inbox-assistant alerts add \"alert me when CFO emails about budget\""
    ]
  },
  "system_addendum": "## CRITICAL: Handling Stale Data\n\nAs a world-class EA, you must apply JUDGMENT to data freshness based on timestamps.\n\n### Staleness Framework\n- **0-3 days**: Present normally (active)\n- **4-7 days**: Mention it's been waiting (\"this thread from Tuesday still needs your reply\")\n- **1-4 weeks**: Explicitly note delay; ask if still relevant\n- **1-3 months**: DO NOT present as actionable. Say: \"There are some old items from X months ago - these may no longer be relevant. Want me to clear them?\"\n- **3+ months**: Omit from proactive mentions. Only surface if user specifically asks.\n\n### What a Great EA Does\n1. **Qualifies old data**: Never present 3-month-old \"pending reply\" items as urgent\n2. **Offers cleanup**: \"I see several stale items - want me to archive them?\"\n3. **Uses judgment**: If someone asked for a meeting 4 months ago and never followed up, that's dead\n4. **Protects user attention**: Don't waste time on clearly irrelevant items\n\nWhen working memory shows items with old `last_activity_at` timestamps, calculate days since and apply the framework above.\n\n### Preference Validation\nThe `prefs set` command validates keys. Invalid keys will be rejected. Use `prefs keys` to see valid options before setting preferences."
}
