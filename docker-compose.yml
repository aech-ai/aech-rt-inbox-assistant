services:
  inbox-assistant:
    build:
      context: .
      dockerfile: Dockerfile
    image: aech-rt-inbox-assistant
    env_file:
      - .env
    volumes:
      - ./data/users/${DELEGATED_USER}:/home/agentaech
      # RT trigger queue root (outbox/processing/done/failed/dedupe)
      - ./data/rt_triggers/inbox-assistant:/triggers:rw
      # Token cache (explicit for clarity)
      - ./data/app_context/aech-cli-msgraph/token_cache.json:/app/token_cache.json
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - OPENAI_API_KEY
      - MSGRAPH_TOKEN
      - DELEGATED_USER
      - POLL_INTERVAL
      - MODEL_NAME
      - AZURE_CLIENT_ID
      - AZURE_TENANT_ID
      - MSGRAPH_TOKEN_CACHE_PATH=/app/token_cache.json
